---
interface Props {
    locale?: "en" | "pt_BR";
    labels: {
        placeholder: string;
        emptyTitle: string;
        emptyText: string;
        initialText: string;
        loadingText: string;
    };
}

const { locale = "en", labels } = Astro.props;
const basePrefix = locale === "pt_BR" ? "/br" : "";
---

<div 
    id="global-search-dialog" 
    class="fixed inset-0 z-100 hidden items-start justify-center pt-[15vh] px-4 font-sans text-text-main"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
>
    {/* Backdrop */}
    <div 
        id="global-search-backdrop"
        class="absolute inset-0 bg-bg/95 backdrop-blur-sm transition-opacity" 
    />

    {/* Modal */}
    <div class="relative w-full max-w-2xl bg-bg-card border border-border rounded-xl shadow-2xl overflow-hidden animate-fade-in-up">
        
        {/* Header / Input */}
        <div class="flex items-center border-b border-border p-4">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-5 h-5 text-text-muted mr-3"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
            >
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input 
                id="global-search-input"
                type="text" 
                placeholder={labels.placeholder}
                class="flex-1 bg-transparent border-none outline-none text-lg text-text-main placeholder-text-muted h-10"
                autocomplete="off"
            />
            <button 
                id="global-search-close"
                class="p-2 ml-2 text-text-muted hover:text-text-main hover:bg-bg-elevated rounded-md transition-colors"
                aria-label="Close"
            >
                <kbd class="hidden md:inline-block px-2 py-0.5 text-xs font-mono bg-bg-elevated rounded border border-border">ESC</kbd>
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 md:hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        {/* Results Area */}
        <div id="global-search-results-container" class="max-h-[60vh] overflow-y-auto">
            {/* Loading State */}
            <div id="global-search-loading" class="hidden p-8 text-center text-text-muted">
                <div class="w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-2"></div>
                {labels.loadingText}
            </div>

            {/* Empty State */}
            <div id="global-search-empty" class="hidden p-12 text-center text-text-muted">
                <p class="font-medium mb-1">{labels.emptyTitle}</p>
                <p class="text-sm">{labels.emptyText}</p>
            </div>
            
            {/* Initial State */}
            <div id="global-search-initial" class="p-12 text-center text-text-muted">
                <p class="text-sm">{labels.initialText}</p>
            </div>

            {/* Results List */}
            <ul id="global-search-results-list" class="divide-y divide-border/50 hidden">
                {/* Dynamically populated */}
            </ul>
        </div>
    </div>
</div>

<script>
    import { initGlobalSearch } from '../../scripts/global-search';
    
    // Get variables passed from Astro
    const locale = document.documentElement.lang === 'pt-BR' ? 'pt_BR' : 'en';
    // Base Prefix calculation: if locale is pt_BR, prefix is /br. Else empty.
    const basePrefix = locale === 'pt_BR' ? '/br' : '';

    initGlobalSearch({ locale, basePrefix });
</script>
