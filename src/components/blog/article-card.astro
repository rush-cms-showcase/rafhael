---
import type { BlogPost } from "../../lib/rush";
import Badge from "../ui/badge.astro";

interface Props {
    post: BlogPost;
}

const { post } = Astro.props;

const formattedDate = new Date(post.published_at).toLocaleDateString("pt-BR", {
    day: "numeric",
    month: "long",
    year: "numeric",
});
---

<article
    class="group flex flex-col bg-bg-card border border-border rounded-2xl overflow-hidden hover:border-primary/50 transition-all duration-300 hover:-translate-y-1"
>
    <a
        href={`/blog/${post.slug}`}
        class="relative aspect-video overflow-hidden"
    >
        {
            post.featured_image ? (
                <img
                    src={post.featured_image.preview || post.featured_image.url}
                    alt={post.title}
                    width="640"
                    height="360"
                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                    loading="lazy"
                    decoding="async"
                />
            ) : (
                <div class="w-full h-full bg-bg-elevated flex items-center justify-center text-text-muted">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="w-12 h-12 opacity-20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <rect
                            x="3"
                            y="3"
                            width="18"
                            height="18"
                            rx="2"
                            ry="2"
                        />
                        <circle cx="8.5" cy="8.5" r="1.5" />
                        <polyline points="21 15 16 10 5 21" />
                    </svg>
                </div>
            )
        }
        {
            post.category && (
                <div class="absolute top-4 left-4">
                    <Badge variant="primary" className="shadow-lg">
                        {post.category.name}
                    </Badge>
                </div>
            )
        }
    </a>

    <div class="flex-1 p-6 flex flex-col">
        <div class="mb-4">
            <time
                datetime={post.published_at}
                class="text-xs text-text-muted uppercase tracking-wider font-medium"
            >
                {formattedDate}
            </time>
        </div>

        <a
            href={`/blog/${post.slug}`}
            class="group-hover:text-primary transition-colors"
        >
            <h3 class="font-serif text-2xl font-bold mb-3 leading-tight">
                {post.title}
            </h3>
        </a>

        <p class="text-text-muted text-sm line-clamp-3 mb-6 flex-grow">
            {post.excerpt || post.content.substring(0, 150) + "..."}
        </p>

        <div
            class="flex items-center justify-between pt-6 border-t border-border-subtle mt-auto"
        >
            <div class="flex items-center gap-2">
                {
                    post.author?.avatar ? (
                        <img
                            src={post.author.avatar}
                            alt={post.author.name}
                            width="32"
                            height="32"
                            class="w-8 h-8 rounded-full border border-border"
                            loading="lazy"
                            decoding="async"
                        />
                    ) : (
                        <div class="w-8 h-8 rounded-full bg-bg-elevated border border-border flex items-center justify-center text-xs font-bold text-text-muted">
                            {post.author?.name.charAt(0) || "R"}
                        </div>
                    )
                }
                <span class="text-xs font-medium text-text-main">
                    {post.author?.name || "Rafhael Marsigli"}
                </span>
            </div>

            <a
                href={`/blog/${post.slug}`}
                class="text-sm font-bold text-primary flex items-center gap-1 group/link"
            >
                Ler mais
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-4 h-4 transition-transform group-hover/link:translate-x-1"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path d="M5 12h14"></path>
                    <path d="m12 5 7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </div>
</article>
