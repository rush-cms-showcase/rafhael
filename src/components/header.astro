---
import Container from "./ui/container.astro";
import Button from "./ui/button.astro";
import type { HomeContent } from "../content/home";
import LanguageSelector from "./language-selector.astro";
import GlobalSearchDialog from "./ui/global-search-dialog";

interface Props {
    content: HomeContent["global"]["nav"];
    locale?: "en" | "pt_BR";
}

const { content, locale = "pt_BR" } = Astro.props;
const homeUrl = locale === "pt_BR" ? "/br" : "/";
const isHome = Astro.url.pathname === homeUrl;

// Map the nav items from the content prop
const navItems = [
    { label: content.about, href: locale === 'pt_BR' ? "/br/sobre-mim" : "/about-me" },
    { label: content.cases, href: `${homeUrl === "/" ? "" : homeUrl}/cases` },
    { label: content.blog, href: `${homeUrl === "/" ? "" : homeUrl}/blog` },
];

const searchLabels = {
    placeholder: locale === 'pt_BR' ? "Buscar artigos..." : "Search articles...",
    emptyTitle: locale === 'pt_BR' ? "Nenhum artigo encontrado" : "No articles found",
    emptyText: locale === 'pt_BR' ? "Tente outros termos." : "Try other terms.",
    initialText: locale === 'pt_BR' ? "Digite para buscar em todos os artigos" : "Type to search across all articles",
    loadingText: locale === 'pt_BR' ? "Carregando índice..." : "Loading index..."
};
---

<header
    class="fixed top-0 left-0 right-0 z-50 py-5 bg-bg/95 backdrop-blur-md border-b border-border/50 transition-all duration-300"
>
    <Container className="flex justify-between items-center">
        <a href={homeUrl} class="flex items-center gap-2 group">
            <div class="flex items-center gap-3">
                <img
                    src="/favicon.svg"
                    fetchpriority="high"
                    width={48}
                    height={48}
                    alt="Rafhael Marsigli Logo"
                    class="w-12 h-12 lg:w-8 lg:h-8"
                />
                <span
                    class="hidden md:block font-serif text-xl font-bold text-text-main group-hover:text-primary transition-colors duration-300"
                >
                    Rafhael <span class="text-primary">Marsigli</span>
                </span>
            </div>
        </a>

        <nav class="hidden md:flex gap-10 items-center ml-auto mr-8">
            {
                navItems.map((item) => (
                    <a
                        href={item.href}
                        class="text-sm lg:text-lg font-medium text-text-muted hover:text-text-main transition-colors"
                    >
                        {item.label}
                    </a>
                ))
            }
        </nav>

        <div class="flex items-center gap-4">
            {/* Search Trigger */}
            <button
                id="search-trigger"
                class="flex items-center justify-center w-10 h-10 text-text-muted hover:text-primary transition-colors hover:bg-bg-elevated rounded-lg group relative"
                aria-label="Search"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <span class="absolute -top-1.5 -right-1.5 flex h-4 w-6 items-center justify-center rounded bg-bg-elevated/90 border border-border/50 text-[9px] font-bold text-text-muted shadow-sm backdrop-blur-sm group-hover:border-primary/50 group-hover:text-primary transition-colors pointer-events-none">
                    ⌘ K
                </span>
            </button>
            <GlobalSearchDialog client:idle locale={locale} labels={searchLabels} />

            <div class="hidden lg:block px-2">
                <LanguageSelector currentLocale={locale} />
            </div>
            <Button
                href={locale === "pt_BR" ? "/br/contato" : "/contact"}
                variant="primary"
                size="md"
                className="hidden md:flex shadow-lg shadow-primary/20"
            >
                <span>{content.contact}</span>
            </Button>

            <button
                id="menu-toggle"
                class="md:hidden flex items-center justify-center w-12 h-12 border border-white/20 rounded-lg text-text-main hover:text-primary transition-colors"
                aria-label="Menu"
            >
                <svg
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </Container>

    <div
        id="mobile-menu"
        class="md:hidden fixed inset-0 top-[73px] opacity-0 pointer-events-none transition-opacity duration-300"
    >
        <Container className="py-8">
            <nav
                class="border border-primary/40 flex flex-col text-center rounded-lg shadow-primary/10 shadow-xl bg-black/98 backdrop-blur-lg"
            >
                {
                    navItems.map((item) => (
                        <a
                            href={item.href}
                            class="text-xl font-medium text-text-muted hover:text-text-main transition-colors py-4 px-3 border-b border-border/30"
                        >
                            {item.label}
                        </a>
                    ))
                }
                <div class="py-3 border-b border-border/30 flex justify-center">
                    <LanguageSelector currentLocale={locale} isMobile={true} />
                </div>
            </nav>
        </Container>
    </div>
</header>

<script is:inline>
    // Search Trigger Logic
    const searchTrigger = document.getElementById("search-trigger");
    if (searchTrigger) {
        searchTrigger.addEventListener("click", () => {
             window.dispatchEvent(new CustomEvent("open-global-search"));
        });
    }

    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");

    if (menuToggle && mobileMenu) {
        menuToggle.addEventListener("click", () => {
            const isOpen = mobileMenu.classList.contains("opacity-100");

            if (isOpen) {
                mobileMenu.classList.remove(
                    "opacity-100",
                    "pointer-events-auto",
                );
                mobileMenu.classList.add("opacity-0", "pointer-events-none");
                document.body.style.overflow = "";
            } else {
                mobileMenu.classList.remove("opacity-0", "pointer-events-none");
                mobileMenu.classList.add("opacity-100", "pointer-events-auto");
                document.body.style.overflow = "hidden";
            }
        });

        mobileMenu.addEventListener("click", (e) => {
            if (e.target.tagName === "A") {
                mobileMenu.classList.remove(
                    "opacity-100",
                    "pointer-events-auto",
                );
                mobileMenu.classList.add("opacity-0", "pointer-events-none");
                document.body.style.overflow = "";
            }
        });
    }
</script>
