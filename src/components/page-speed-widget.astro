---
import type { HomeContent } from "../content/home";

interface Props {
    stats: HomeContent["hero"]["stats"];
}

const { stats } = Astro.props;
---

<div
    class="bg-black/40 backdrop-blur-xl border border-white/10 p-8 rounded-2xl shadow-2xl max-w-[620px] w-full mx-auto transform hover:scale-[1.02] transition-transform duration-500 font-sans relative z-10"
>
    <div
        class="flex justify-between gap-4 mb-12 border-b border-border-subtle pb-8"
    >
        <div class="flex flex-col items-center gap-2">
            <div class="relative w-12 h-12 flex items-center justify-center">
                <svg
                    class="w-full h-full transform -rotate-90"
                    viewBox="0 0 36 36"
                >
                    <path
                        class="text-bg-elevated"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="3"></path>
                    <path
                        id="circle-perf"
                        class="text-green-500 transition-all duration-2000 ease-out"
                        stroke-dasharray="100, 100"
                        stroke-dashoffset="100"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="3"></path>
                </svg>
                <span
                    id="score-perf"
                    class="absolute text-xs font-bold text-text-main">0</span
                >
            </div>
            <span class="text-[10px] text-text-muted font-medium"
                >{stats.performance}</span
            >
        </div>

        <div class="flex flex-col items-center gap-2">
            <div class="relative w-12 h-12 flex items-center justify-center">
                <svg
                    class="w-full h-full transform -rotate-90"
                    viewBox="0 0 36 36"
                >
                    <path
                        class="text-bg-elevated"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="3"></path>
                    <path
                        id="circle-access"
                        class="text-green-500 transition-all duration-2000 ease-out"
                        stroke-dasharray="100, 100"
                        stroke-dashoffset="100"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="3"></path>
                </svg>
                <span
                    id="score-access"
                    class="absolute text-xs font-bold text-text-main">0</span
                >
            </div>
            <span class="text-[10px] text-text-muted font-medium"
                >{stats.accessibility}</span
            >
        </div>

        <div class="flex flex-col items-center gap-2">
            <div class="relative w-12 h-12 flex items-center justify-center">
                <svg
                    class="w-full h-full transform -rotate-90"
                    viewBox="0 0 36 36"
                >
                    <path
                        class="text-bg-elevated"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="3"></path>
                    <path
                        id="circle-practices"
                        class="text-green-500 transition-all duration-2000 ease-out"
                        stroke-dasharray="100, 100"
                        stroke-dashoffset="100"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="3"></path>
                </svg>
                <span
                    id="score-practices"
                    class="absolute text-xs font-bold text-text-main">0</span
                >
            </div>
            <span class="text-[10px] text-text-muted font-medium text-center"
                >{stats.bestPractices}</span
            >
        </div>

        <div class="flex flex-col items-center gap-2">
            <div class="relative w-12 h-12 flex items-center justify-center">
                <svg
                    class="w-full h-full transform -rotate-90"
                    viewBox="0 0 36 36"
                >
                    <path
                        class="text-bg-elevated"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="3"></path>
                    <path
                        id="circle-seo"
                        class="text-green-500 transition-all duration-2000 ease-out"
                        stroke-dasharray="100, 100"
                        stroke-dashoffset="100"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="3"></path>
                </svg>
                <span
                    id="score-seo"
                    class="absolute text-xs font-bold text-text-main">0</span
                >
            </div>
            <span class="text-[10px] text-text-muted font-medium">{stats.seo}</span>
        </div>
    </div>

    <div class="flex flex-col items-center justify-center">
        <div class="relative w-48 h-48 flex items-center justify-center mb-6">
            <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                <path
                    class="text-bg-elevated"
                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2.5"></path>
                <path
                    id="progress-circle-main"
                    class="text-green-500 transition-all duration-2000 ease-out"
                    stroke-dasharray="100, 100"
                    stroke-dashoffset="100"
                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2.5"
                    stroke-linecap="round"></path>
            </svg>
            <div class="absolute inset-0 flex items-center justify-center">
                <span
                    id="score-counter-main"
                    class="text-6xl font-bold text-text-main">0</span
                >
            </div>
        </div>

        <h3 class="text-2xl font-medium text-text-main mb-6">{stats.mainLabel}</h3>

        <div class="flex items-center gap-6 text-sm">
            <div class="flex items-center gap-2">
                <div
                    class="w-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-b-10 border-b-red-500"
                >
                </div>
                <span class="text-text-muted">0-49</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-yellow-400 rounded-sm"></div>
                <span class="text-text-muted">50-89</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                <span class="text-text-muted">90-100</span>
            </div>
        </div>
    </div>
</div>

<script is:inline>
    function animateWidget() {
        const duration = 2000

        const randomScore = () =>
            Math.floor(Math.random() * (100 - 97 + 1)) + 97

        const perfScore = randomScore()
        const accessScore = 100
        const practiceScore = 100
        const seoScore = 100

        const animations = [
            { id: 'perf', score: perfScore },
            { id: 'access', score: accessScore },
            { id: 'practices', score: practiceScore },
            { id: 'seo', score: seoScore },
            {
                id: null,
                score: perfScore,
                counterId: 'score-counter-main',
                circleId: 'progress-circle-main'
            }
        ]

        animations.forEach((item) => {
            const circle = document.getElementById(
                item.circleId || `circle-${item.id}`
            )
            const counter = document.getElementById(
                item.counterId || `score-${item.id}`
            )
            if (circle) circle.style.strokeDashoffset = '100'
            if (counter) counter.innerText = '0'
        })

        setTimeout(() => {
            const startTime = performance.now()

            animations.forEach((item) => {
                const circle = document.getElementById(
                    item.circleId || `circle-${item.id}`
                )
                if (circle) {
                    circle.style.strokeDashoffset = (
                        100 - item.score
                    ).toString()
                }
            })

            function update(currentTime) {
                const elapsed = currentTime - startTime
                const progress = Math.min(elapsed / duration, 1)

                const ease = progress * (2 - progress)

                animations.forEach((item) => {
                    const counter = document.getElementById(
                        item.counterId || `score-${item.id}`
                    )
                    if (counter) {
                        const currentVal = Math.round(item.score * ease)
                        counter.innerText = currentVal.toString()
                    }
                })

                if (progress < 1) {
                    requestAnimationFrame(update)
                }
            }

            requestAnimationFrame(update)
        }, 300)
    }

    document.addEventListener('DOMContentLoaded', animateWidget)
    document.addEventListener('astro:page-load', animateWidget)
</script>
